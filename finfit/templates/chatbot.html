<!-- ğŸ”µ Floating Chatbot UI ìµœì¢… ì™„ì„±ë³¸ -->
<style>
  /* ğŸ”¹ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
  @keyframes fadeSlideUp {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }


  
  #fitbot-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    border-radius: 30px;
    padding: 10px 20px;
    background-color: #444;
    color: white;
    font-weight: bold;
    border: 2px solid rgb(255, 255, 255);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    cursor: pointer;
  }
  #fitbot-toggle:hover {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    border-radius: 30px;
    padding: 10px 20px;
    background-color: #777777;
    color: white;
    font-weight: bold;
    border: 2px solid white;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    cursor: pointer;
  }

  #fitbot-chat-container {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 320px;
    height: 440px;
    background: rgba(30, 30, 30, 0.92);  /* âœ… ì‚´ì§ ë¹„ì¹˜ëŠ” ì–´ë‘ìš´ ë°°ê²½ */
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    display: none;
    flex-direction: column;
    z-index: 9998;
    overflow: hidden;
    border: none;
  }

  #fitbot-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
    background-color:rgba(42, 42, 42, 0.70);
    display: flex;
    flex-direction: column;
  }

  #fitbot-input-container {
    display: flex;
    border-top: 1px solid #eee;
    background: white;
    border-radius: 16px;
  }

  #fitbot-input {
    flex: 1;
    border: none;                 /* âœ… í…Œë‘ë¦¬ ì œê±°! */
    padding: 10px;
    font-size: 14px;
    border-radius: 16px;
  }

  #fitbot-input:focus {
    outline: none;       /* âœ… íŒŒë€ ì™¸ê³½ì„  ì œê±° */
    border: none;        /* âœ… í…Œë‘ë¦¬ ì™„ì „ ì œê±° */
    box-shadow: none;    /* âœ… ë¸Œë¼ìš°ì €ê°€ ë„£ëŠ” íš¨ê³¼ ì œê±° */
  }
  

  #fitbot-send {
    background:gray;
    color: white;
    border: none;
    padding: 10px 15px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 16px;
  }

  /* ë§í’ì„  ê³µí†µ ìŠ¤íƒ€ì¼ */
  .fitbot-bubble {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 85%;
    word-break: break-word;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    
    /* âœ… ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
    animation: fadeSlideUp 0.3s ease-out;
  }

  .fitbot-user {
    background-color:#008b8b;
    align-self: flex-end;
    text-align: right;
    position: relative;
    color: white;
  }

  .fitbot-user::after {
    content: "";
    position: absolute;
    right: -6px;
    top: 12px;
    width: 0;
    height: 0;
    border-left: 8px solid#008b8b;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
  }

  .fitbot-bot {
    background-color:#3b3b3b;
    align-self: flex-start;
    text-align: left;
    position: relative;
    color: white;
  }

  .fitbot-bot::after {
    content: "";
    position: absolute;
    left: -6px;
    top: 12px;
    width: 0;
    height: 0;
    border-right: 8px solid #3b3b3b;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
  }

  /* ë°œì‹ ì ë¼ë²¨ + ì „ì²´ ë¬¶ìŒ */
  .fitbot-message-wrapper {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
  }

  .fitbot-message-wrapper.user .fitbot-sender {
    text-align: right;
    padding-right: 6px;
  }

  .fitbot-message-wrapper.bot .fitbot-sender {
    text-align: left;
    padding-left: 6px;
  }

  .fitbot-sender {
    font-size: 13px;
    font-weight: bold;
    color: #ffffff;
    margin-bottom: 2px;
  }

  @media (max-width: 768px) {
    #fitbot-chat-container {
      width: 50vw;              /* âœ… í™”ë©´ ë„ˆë¹„ì˜ 90% */
      height: 30vh;             /* âœ… ë†’ì´ëŠ” í™”ë©´ì˜ 60% ì •ë„ */
      right: 3vw;               /* âœ… ì˜¤ë¥¸ìª½ ì—¬ë°± */
      bottom: 70px;            /* âœ… í•˜ë‹¨ ì—¬ë°± (ì „ì†¡ ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ) */
    }
  
    #fitbot-toggle {
      bottom: 20px;
      right: 20px;
      padding: 8px 16px;
      font-size: 14px;
    }
  
    #fitbot-input {
      font-size: 13px;
      padding: 8px;
    }
  
    #fitbot-send {
      font-size: 13px;
      padding: 8px 12px;
    }
  }
</style>

<!-- ğŸŸ¦ Toggle Button -->
<button id="fitbot-toggle">Fitë´‡</button>

<!-- ğŸ’¬ Chatbot Box -->
<div id="fitbot-chat-container">
  <div id="fitbot-messages"></div>
  <div id="fitbot-input-container">
    <input id="fitbot-input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
    <button id="fitbot-send">ì „ì†¡</button>
  </div>
</div>

<!-- âœ… JS Logic -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const toggleBtn = document.getElementById('fitbot-toggle');
  const chatContainer = document.getElementById('fitbot-chat-container');
  const input = document.getElementById('fitbot-input');
  const sendBtn = document.getElementById('fitbot-send');
  const messages = document.getElementById('fitbot-messages');

  // í˜„ì¬ í˜ì´ì§€ íŒŒì•…
  const path = window.location.pathname;
  const page = path.includes("disease") ? "disease"
             : path.includes("squat") ? "squat"
             : path.includes("hospital") ? "hospital"
             : path.includes("exercise") ? "exercise"
             : path.includes("depression") ? "depression"
             : path.includes("customer") ? "customer"
             : "main";

  toggleBtn.addEventListener('click', () => {
    const isVisible = chatContainer.style.display === 'flex';
    chatContainer.style.display = isVisible ? 'none' : 'flex';

    // ì¸ì‚¬ë§ì€ í•œ ë²ˆë§Œ
    if (!isVisible && messages.children.length === 0) {
      appendMessage('Fitë´‡', `ì•ˆë…•í•˜ì„¸ìš”! ê±´ê°•ë„ìš°ë¯¸ Fitë´‡ì´ì—ìš”. '${page}' í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`, 'fitbot-bot');
    }
  });

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') sendMessage();
  });

  function sendMessage() {
    const userMsg = input.value.trim();
    if (!userMsg) return;

    appendMessage('ì‚¬ìš©ì', userMsg, 'fitbot-user');
    input.value = '';

    fetch('/chatbot', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: userMsg, page: page })
    })
    .then(res => res.json())
    .then(data => appendMessage('Fitë´‡', data.reply, 'fitbot-bot'))
    .catch(err => appendMessage('Fitë´‡', 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 'fitbot-bot'));
  }

  function appendMessage(sender, text, className) {
    const wrapper = document.createElement('div');
    wrapper.className = `fitbot-message-wrapper ${className.includes('user') ? 'user' : 'bot'}`;

    const senderLabel = document.createElement('div');
    senderLabel.className = 'fitbot-sender';
    senderLabel.textContent = sender;

    const msg = document.createElement('div');
    msg.className = 'fitbot-bubble ' + className;
    msg.textContent = text;

    wrapper.appendChild(senderLabel);
    wrapper.appendChild(msg);
    messages.appendChild(wrapper);
    messages.scrollTop = messages.scrollHeight;
  }
});
</script>
